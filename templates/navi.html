<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§­ ì‹¤ë‚´ ë„¤ë¹„ê²Œì´ì…˜</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        /* í˜„ì¬ ìœ„ì¹˜ ì¹´ë“œ */
        .current-location {
            background: linear-gradient(135deg, #00d4ff33, #00d4ff11);
            border: 2px solid #00d4ff;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .current-room {
            font-size: 3rem;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .current-label {
            color: #888;
            margin-top: 5px;
        }
        
        /* ëª©ì ì§€ ì„ íƒ */
        .destination-section {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .destination-section h3 {
            margin-bottom: 15px;
            color: #00d4ff;
        }
        
        .room-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .room-btn {
            padding: 15px 10px;
            border: 2px solid #333;
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .room-btn:hover {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }
        
        .room-btn.selected {
            border-color: #00d4ff;
            background: #00d4ff;
            color: #000;
        }
        
        .room-btn.current {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.2);
        }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ ì•ˆë‚´ */
        .navigation-panel {
            background: linear-gradient(135deg, #1a1a3e, #2a2a5e);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            display: none;
        }
        
        .navigation-panel.active {
            display: block;
        }
        
        .nav-direction {
            font-size: 5rem;
            margin-bottom: 10px;
        }
        
        .nav-instruction {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .nav-distance {
            font-size: 3rem;
            color: #00d4ff;
            font-weight: bold;
        }
        
        .nav-distance-label {
            color: #888;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            background: #333;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            height: 100%;
            transition: width 0.5s;
        }
        
        .nav-status {
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            font-weight: bold;
        }
        
        .nav-status.navigating {
            background: #00d4ff;
            color: #000;
        }
        
        .nav-status.arrived {
            background: #2ecc71;
            color: #fff;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* ë¹ ë¥¸ ì´ë™ ë²„íŠ¼ */
        .quick-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-btn.toilet { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #fff; }
        .quick-btn.stair { background: linear-gradient(135deg, #e74c3c, #c0392b); color: #fff; }
        .quick-btn.elevator { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
        .quick-btn.exit { background: linear-gradient(135deg, #f39c12, #d68910); color: #fff; }
        
        /* ì·¨ì†Œ ë²„íŠ¼ */
        .cancel-btn {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: #ff4757;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* ë³µë„ ë¯¸ë‹ˆë§µ */
        .minimap {
            background: #0a0a15;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .minimap-track {
            position: relative;
            height: 40px;
            background: #1a1a2e;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .minimap-current {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #00d4ff;
            border-radius: 50%;
            top: 12px;
            transform: translateX(-50%);
            box-shadow: 0 0 15px #00d4ff;
            transition: left 0.5s;
        }
        
        .minimap-dest {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #ff4757;
            border-radius: 50%;
            top: 12px;
            transform: translateX(-50%);
            transition: left 0.5s;
        }
        
        .minimap-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§­ ì‹¤ë‚´ ë„¤ë¹„ê²Œì´ì…˜</h1>
        
        <!-- í˜„ì¬ ìœ„ì¹˜ -->
        <div class="current-location">
            <div class="current-room" id="currentRoom">7413</div>
            <div class="current-label">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>
        </div>
        
        <!-- ëª©ì ì§€ ì„ íƒ (ë„¤ë¹„ê²Œì´ì…˜ ì•ˆí•  ë•Œ) -->
        <div class="destination-section" id="destSection">
            <h3>ğŸ¯ ëª©ì ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="room-grid" id="roomGrid">
                <!-- JSë¡œ ìƒì„± -->
            </div>
            
            <h3 style="margin-top:20px;">âš¡ ë¹ ë¥¸ ì´ë™</h3>
            <div class="quick-nav">
                <button class="quick-btn toilet" onclick="navigateTo('WC')">ğŸš» í™”ì¥ì‹¤</button>
                <button class="quick-btn stair" onclick="navigateTo('STAIR')">ğŸšª ê³„ë‹¨</button>
                <button class="quick-btn elevator" onclick="navigateTo('EV')">ğŸ›— ì—˜ë¦¬ë² ì´í„°</button>
                <button class="quick-btn exit" onclick="navigateTo('EXIT')">ğŸš¨ ë¹„ìƒêµ¬</button>
            </div>
        </div>
        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ íŒ¨ë„ -->
        <div class="navigation-panel" id="navPanel">
            <div class="nav-direction" id="navDirection">â¡ï¸</div>
            <div class="nav-instruction" id="navInstruction">ì§ì§„í•˜ì„¸ìš”</div>
            
            <div class="nav-distance" id="navDistance">35.0</div>
            <div class="nav-distance-label">ë¯¸í„° ë‚¨ìŒ</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            
            <div class="nav-status navigating" id="navStatus">ğŸš¶ ì´ë™ ì¤‘...</div>
            
            <!-- ë¯¸ë‹ˆë§µ -->
            <div class="minimap">
                <div class="minimap-labels">
                    <span>7414</span>
                    <span>7413</span>
                    <span>7411</span>
                    <span>7408</span>
                    <span>7405</span>
                    <span>7401</span>
                </div>
                <div class="minimap-track">
                    <div class="minimap-current" id="minimapCurrent"></div>
                    <div class="minimap-dest" id="minimapDest"></div>
                </div>
            </div>
            
            <button class="cancel-btn" onclick="cancelNavigation()">âŒ ì•ˆë‚´ ì¢…ë£Œ</button>
        </div>
    </div>
    
    <script>
        // í˜¸ì‹¤ ìœ„ì¹˜ (7413 = 0m)
        const ROOMS = {
            "7414": -5.0,
            "7413": 0.0,
            "7412": 15.0,
            "7411": 20.0,
            "7410": 25.0,
            "7409": 30.0,
            "7408": 35.0,
            "7407": 40.0,
            "7406": 45.0,
            "7405": 50.0,
            "7404": 55.0,
            "7403": 60.0,
            "7401": 65.0,
        };
        
        // ì‹œì„¤ ìœ„ì¹˜
        const FACILITIES = {
            "WC": 8.0,      // í™”ì¥ì‹¤ (7413 ì™¼ìª½)
            "EV": 11.0,     // ì—˜ë¦¬ë² ì´í„°
            "STAIR": 5.0,   // ê³„ë‹¨
            "EXIT": 5.0,    // ë¹„ìƒêµ¬ = ê³„ë‹¨
        };
        
        let currentPosition = 0;
        let currentRoom = "7413";
        let destination = null;
        let destPosition = null;
        let isNavigating = false;
        let startPosition = 0;
        
        // í˜¸ì‹¤ ë²„íŠ¼ ìƒì„±
        function createRoomButtons() {
            const grid = document.getElementById('roomGrid');
            grid.innerHTML = '';
            
            Object.keys(ROOMS).forEach(room => {
                const btn = document.createElement('button');
                btn.className = 'room-btn';
                btn.textContent = room;
                btn.onclick = () => navigateTo(room);
                
                if (room === currentRoom) {
                    btn.classList.add('current');
                }
                
                grid.appendChild(btn);
            });
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ì‹œì‘
        function navigateTo(dest) {
            destination = dest;
            
            if (ROOMS[dest] !== undefined) {
                destPosition = ROOMS[dest];
            } else if (FACILITIES[dest] !== undefined) {
                destPosition = FACILITIES[dest];
            } else {
                alert('ì•Œ ìˆ˜ ì—†ëŠ” ëª©ì ì§€');
                return;
            }
            
            startPosition = currentPosition;
            isNavigating = true;
            
            document.getElementById('destSection').style.display = 'none';
            document.getElementById('navPanel').classList.add('active');
            
            updateNavigation();
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ì·¨ì†Œ
        function cancelNavigation() {
            isNavigating = false;
            destination = null;
            destPosition = null;
            
            document.getElementById('destSection').style.display = 'block';
            document.getElementById('navPanel').classList.remove('active');
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
        function updateNavigation() {
            if (!isNavigating) return;
            
            const distance = destPosition - currentPosition;
            const absDistance = Math.abs(distance);
            
            // ë°©í–¥
            const dirEl = document.getElementById('navDirection');
            const instrEl = document.getElementById('navInstruction');
            
            if (absDistance < 2) {
                // ë„ì°©!
                dirEl.textContent = 'ğŸ‰';
                instrEl.textContent = `${destination} ë„ì°©!`;
                document.getElementById('navStatus').className = 'nav-status arrived';
                document.getElementById('navStatus').textContent = 'âœ… ë„ì°©í–ˆìŠµë‹ˆë‹¤!';
                
                // ì§„ë™ (ëª¨ë°”ì¼)
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            } else if (distance > 0) {
                // ì•ìœ¼ë¡œ (7401 ë°©í–¥)
                dirEl.textContent = 'â¡ï¸';
                instrEl.textContent = 'ì§ì§„í•˜ì„¸ìš” â†’';
                document.getElementById('navStatus').className = 'nav-status navigating';
                document.getElementById('navStatus').textContent = 'ğŸš¶ ì´ë™ ì¤‘...';
            } else {
                // ë’¤ë¡œ (7414 ë°©í–¥)
                dirEl.textContent = 'â¬…ï¸';
                instrEl.textContent = 'â† ë’¤ë¡œ ê°€ì„¸ìš”';
                document.getElementById('navStatus').className = 'nav-status navigating';
                document.getElementById('navStatus').textContent = 'ğŸš¶ ì´ë™ ì¤‘...';
            }
            
            // ê±°ë¦¬
            document.getElementById('navDistance').textContent = absDistance.toFixed(1);
            
            // ì§„í–‰ë¥ 
            const totalDistance = Math.abs(destPosition - startPosition);
            const traveled = totalDistance - absDistance;
            const progress = totalDistance > 0 ? (traveled / totalDistance) * 100 : 0;
            document.getElementById('progressFill').style.width = Math.min(100, Math.max(0, progress)) + '%';
            
            // ë¯¸ë‹ˆë§µ ì—…ë°ì´íŠ¸
            updateMinimap();
        }
        
        // ë¯¸ë‹ˆë§µ ì—…ë°ì´íŠ¸
        function updateMinimap() {
            const minPos = -10;
            const maxPos = 70;
            const range = maxPos - minPos;
            
            const currentPct = ((currentPosition - minPos) / range) * 100;
            document.getElementById('minimapCurrent').style.left = currentPct + '%';
            
            if (destPosition !== null) {
                const destPct = ((destPosition - minPos) / range) * 100;
                document.getElementById('minimapDest').style.left = destPct + '%';
                document.getElementById('minimapDest').style.display = 'block';
            } else {
                document.getElementById('minimapDest').style.display = 'none';
            }
        }
        
        // ì„œë²„ì—ì„œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        async function fetchPosition() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                currentPosition = data.position;
                currentRoom = data.room;
                
                document.getElementById('currentRoom').textContent = currentRoom;
                
                // ë²„íŠ¼ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.room-btn').forEach(btn => {
                    btn.classList.remove('current');
                    if (btn.textContent === currentRoom) {
                        btn.classList.add('current');
                    }
                });
                
                if (isNavigating) {
                    updateNavigation();
                }
                
                updateMinimap();
                
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // ì´ˆê¸°í™”
        createRoomButtons();
        fetchPosition();
        updateMinimap();
        
        // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
        setInterval(fetchPosition, 500);
    </script>
</body>
</html>
